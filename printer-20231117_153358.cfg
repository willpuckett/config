[include fluidd.cfg]
[virtual_sdcard]
path: /home/puck/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[include macros/*.cfg]

[include mcus.cfg]
[include steppers.cfg]
[include thermals.cfg]
# [include resonance.cfg]
    
# Tools 
[include micro-swiss.cfg]
# [include laser.cfg]


[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 1500
max_z_velocity: 10
max_z_accel: 60
square_corner_velocity: 5.0

[gcode_arcs]

[respond]
#default_type: echo
#   Sets the default prefix of the "M118" and "RESPOND" output to one
#   of the following:
#       echo: "echo: " (This is the default)
#       command: "// "
#       error: "!! "
#default_prefix: echo:
#   Directly sets the default prefix. If present, this value will
#   override the "default_type".

[neopixel hermie_rgb]
pin: hermie:PA8
chain_count: 2
color_order: GRB
initial_RED: 0.5
initial_GREEN: 0.5
initial_BLUE: 0.5


[homing_override]
gcode: 
    {% set HOME_CUR = 0.300 %}
    {% set driver_config_x = printer.configfile.settings['tmc2209 stepper_x'] %}
    {% set driver_config_y = printer.configfile.settings['tmc2209 stepper_y'] %}
    {% set RUN_CUR_X = driver_config_x.run_current %}
    {% set RUN_CUR_Y = driver_config_y.run_current %}
    # Set current for sensorless homing
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CUR}
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CUR}
    # Pause to ensure driver stall flag is clear
    G4 P2000
    # Home
    G28
    # Set stepper_x back to run current
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CUR_X}
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CUR_Y}
    # Move up to not whack bed, and then to xy 0
    G0 Z6
    G0 X0 Y0

[delayed_gcode bed_mesh_init]
initial_duration: .01
gcode:
  BED_MESH_PROFILE LOAD=default

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#


#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.371000, 0.263500, 0.206000, 0.248500, 0.373500
#*# 	  0.328500, 0.318500, 0.216000, 0.278500, 0.408500
#*# 	  0.361000, 0.241000, 0.268500, 0.343500, 0.751000
#*# 	  0.396000, 0.266000, 0.256000, 0.381000, 0.616000
#*# 	  0.661000, 0.406000, 0.433500, 0.463500, 0.688500
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 0.0
#*# max_x = 360.0
#*# min_y = 0.0
#*# max_y = 360.0